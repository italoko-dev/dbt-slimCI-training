name: dbt-slimCI
run-name: pull-requests workflow
on:
  pull_request:
    branches:
      - dev
jobs:
  pull-requests:
    runs-on: ubuntu-latest
    
    steps: 
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      
      # - name: Fetch all branches
      #   run: git fetch --all
        
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '>=3.12'

      - name: Install dependencies
        run: |
          pip install sqlfluff
          pip install -r requirements.txt
          dbt deps
      
      - name: Checkout source branch and diff quality
        run:  |
          git checkout ${{ github.head_ref }}
          diff-quality --violations=sqlfluff --fail-under=95 --compare-branch=origin/dev
      
      # - name: List files in the repository
      #   run: |
      #     ls ${{ github.workspace }}
      # - run: echo "üçè This job's status is ${{ job.status }}."

      #Removed steps
      - name: Draft dbt slimCI flow
        run: echo "Lint On Code."
      - run: echo "Download artifact (manifest dbt) from develop"
      - run: echo "dbt RUN select state modified+"
      - run: echo "dbt TEST select state modified+"
