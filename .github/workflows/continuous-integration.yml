name: dbt-slimCI
run-name: pull-requests workflow
on:
  pull_request:
    branches:
      - dev
jobs:
  pull-requests:
    runs-on: ubuntu-latest
    
    steps: 
      - name: Check out repository code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history
        
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '>=3.12'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          cd dbt_slimCI
          dbt deps
      
      - name: LINT - Checkout source branch and diff quality
        run:  |
        
          cd dbt_slimCI
          sqlfluff lint models --dialect=postgres
        # git checkout ${{ github.head_ref }}
        # cd dbt_slimCI
        # diff-quality --violations=sqlfluff --fail-under=95 --compare-branch=origin/dev

      #Removed steps
    #  - name: Draft dbt slimCI flow
    #    run: |
    #      cd dbt_slimCI
    #      dbt ls
     # - run: echo "Download artifact (manifest dbt) from develop"

      - name: Download develop artifact    
        uses: actions/download-artifact@v4
      #  with:
      #    name: manifest
      #    path: your/destination/dir
      
      - name: Display structure of downloaded files
        run: ls -R
     #   run: ls -R your/destination/dir
      
      - run: echo "dbt RUN select state modified+"
      - run: echo "dbt TEST select state modified+"
